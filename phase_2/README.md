# Phase 2 — Multi-Asset Strategy System & Portfolio Construction

## Overview

**Phase 2** represents the transition from isolated strategy experiments to a **fully structured, multi-asset trading system** with:

- Independent per-asset strategies (Trend & Mean Reversion)
- A meta-allocation layer that dynamically selects between strategies
- A portfolio construction layer that allocates capital across assets
- Volatility targeting and risk control
- Walk-forward evaluation across assets and portfolios
- Stress testing and allocator stability analysis

Unlike Phase 1, Phase 2 is **not exploratory**.  
Every component is deterministic, auditable, and validated through structured walk-forward notebooks.

---

## Phase 2 Goals

Phase 2 answers the following questions:

1. Can individual strategies generalize under walk-forward testing?
2. Can a meta-allocator select between strategies without overfitting?
3. Can capital be allocated across assets in a risk-aware manner?
4. What are the system’s dominant drawdown failure modes?
5. How stable is the allocator under small perturbations?

This phase is explicitly about **system behavior**, not prediction.

---

## What Needs to Be Run (and What Does Not)

This section defines **everything required to reproduce Phase 2 end-to-end**.

Only the **data ingest and validation scripts** must be executed manually.  
All strategies, allocators, portfolio construction, walk-forwards, stress tests, and robustness analyses are **validated exclusively through notebooks**.

---

## Required Scripts (Must Be Run)

#### 1. Multi-Asset Data Ingest (SPY, AAPL, MSFT)

```bash
python phase_2/scripts/ingest/ingest_yahoo_multi_v1.py
```

Purpose: Downloads historical daily data from Yahoo Finance (Symbols ingests are SPY, AAPL, MSFT)
    - Writes raw parquet file to phase_2/data/raw

#### 2. Single-Asset SPY Ingest (SPY-only-workflows)

```bash
python phase_2/scripts/ingest/ingest_spy_yahoo_v1.py
```

Purpose: Used for SPY-specific audits and early strategy validation
    - Produces phase_2/data/raw/spy_yahoo_raw.parquet

#### 3. Multi-Asset Clean & Validation Pipeline

```bash 
python phase_2/scripts/clean_validate/clean_validate_daily_v1.py
```

Purpose: Cleans raw Yahoo Finance data, aligns trading calendars across assets, validates prices, returns, and data continuity
    - Write processed daily data to phase_2/data/processed/

#### 4. SPY-Only Validation

```bash
python phase_2/scripts/clean_validate/validate_spy_daily_v1.py
```

Purpose: Performs stricter SPY-specific validation checks 
    - Used by early audit and single asset notebooks

---

### What Does Not Need to Be Run

The following components do not require manual execution:
    - Strategy implementations (trend, meanrev)
    - Meta allocator logic
    - Risk targeting logic
    - Portfolio construction logic 

These components are imported and exercised entirely within notebooks and are covered by walk-forward validation

---

## Notebook Execution and Validation

All remaining Phase 2 functionality is evaluated through notebooks.  
Notebooks act as **verification layers**, not ad-hoc experimentation.

---

### Recommended Notebook Execution Order

#### Data & Strategy Validation
- `01_spy_data_audit.ipynb`
- `02_trend_strategy_v1_test.ipynb`
- `03_walkforward_trend.ipynb`
- `04_meanrev_strategy_v1_test.ipynb`
- `05_walkforward_mean_rev.ipynb`

---

#### Meta Allocation
- `06_meta_allocator_smoke_test.ipynb`
- `07_meta_allocator_walkforward.ipynb`

---

#### Multi-Asset & Portfolio
- `08_multi_asset_audit.ipynb`
- `09_per_asset_system_walkforward.ipynb`
- `10_portfolio_walkforward.ipynb`

---

#### Stress Testing & Robustness
- `11_stress_tests_and_failures.ipynb`
- `12_allocator_stability_sweep.ipynb`

---

### Notebook Guarantees

Each notebook:
- Is deterministic and reproducible
- Uses only data generated by the required scripts
- Validates one layer of the system in isolation or in composition

---

## Phase 2 Outputs

Phase 2 produces:

- Walk-forward validated strategy return streams
- Meta-allocator regime behavior
- Multi-asset portfolio equity curves
- Drawdown attribution by asset and state
- Failure-mode diagnostics
- Allocator stability under small parameter perturbations

---

### Phase 2 Completion Criteria

Phase 2 is considered complete when:

- Drawdown causes are understood and cataloged
- Allocator behavior is stable under perturbation
- Further improvements are architectural rather than parametric
